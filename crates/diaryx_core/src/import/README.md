---
title: Import module
description: Import external formats into Diaryx entries
part_of: '[README](/crates/diaryx_core/src/README.md)'
attachments:
  - '[mod.rs](/crates/diaryx_core/src/import/mod.rs)'
  - '[email.rs](/crates/diaryx_core/src/import/email.rs)'
  - '[dayone.rs](/crates/diaryx_core/src/import/dayone.rs)'
  - '[markdown.rs](/crates/diaryx_core/src/import/markdown.rs)'
exclude:
  - '*.lock'
---

# Import Module

Import external data formats into Diaryx workspace entries. Each format is feature-gated so only the needed dependencies are compiled.

## Feature Flags

| Format  | Feature         | Dependencies                                     |
|---------|-----------------|--------------------------------------------------|
| Email    | `import-email`    | `mailparse`, `mbox-reader`, `html-to-markdown-rs` |
| Day One  | `import-dayone`   | _(none — uses `serde_json` already in workspace)_  |
| Markdown | `import-markdown` | _(none — uses `frontmatter` + `chrono` already in workspace)_ |

## Files

- `mod.rs` — Common types: `ImportedEntry`, `ImportedAttachment`, `ImportOptions`, `ImportResult`
- `email.rs` — `.eml` and `.mbox` parsing via `mailparse` / `mbox-reader`
- `dayone.rs` — Day One `Journal.json` parsing via `serde_json`
- `markdown.rs` — Markdown file parsing (frontmatter extraction, title/date detection)

## Architecture

Parsers are pure functions that return `ImportedEntry` values with no filesystem I/O. The CLI handler (`crates/diaryx/src/cli/import.rs`) is responsible for reading source files, writing entries to disk, and building the workspace index hierarchy.

### Email Import

- `parse_eml(bytes)` — Parse a single RFC 2822 message
- `parse_mbox(path)` — Parse all messages in an mbox archive (uses memory-mapped I/O)

Body extraction prefers `text/plain`; falls back to `text/html` converted to markdown via `html-to-markdown-rs`. Attachments are collected from MIME parts with `Content-Disposition: attachment` or non-text content types.

### Day One Import

- `parse_dayone(bytes)` — Parse a Day One `Journal.json` export into entries

Extracts the title from the first `# heading` in each entry's `text` field, unescapes Day One's markdown escaping (`\.` → `.`, `\!` → `!`, etc.), and collects metadata (tags, location, weather, starred, uuid). Photo/video/audio identifiers are recorded as empty attachments for future media resolution.

### Markdown Directory Import

- `parse_markdown_file(bytes, filename)` — Parse a single `.md` file into an `ImportedEntry`

Title extraction priority: frontmatter `title` > first `# heading` (stripped from body) > filename stem title-cased. Date extraction: frontmatter `date` parsed with chrono (RFC 3339, ISO 8601, date-only). Existing frontmatter is preserved as metadata; `title`, `date`, `part_of`, and `contents` are removed from metadata (they go to dedicated fields or are regenerated by the CLI handler).

Unlike email/Day One importers, the markdown CLI handler preserves the source directory structure instead of reorganizing by date. Non-markdown files (images, PDFs, etc.) are copied alongside so relative references keep working. Each directory gets an index file with `contents` and `attachments` properties.

### Workspace Organization (Email/Day One)

The CLI writes email and Day One entries into a date-based hierarchy:

```
{folder}/
  index.md
  {YYYY}/
    {YYYY}_index.md
    {MM}/
      {YYYY}_{MM}.md
      {YYYY}-{MM}-{DD}-{slug}.md
      {YYYY}-{MM}-{DD}-{slug}/
        _attachments/
          report.pdf
```

### Workspace Organization (Markdown Directory)

The CLI preserves source directory structure:

```
{folder}/
  index.md                          # root index with contents
  {subdir}/
    {subdir}_index.md               # directory index with contents + part_of + attachments
    file.md                         # copied with part_of link
    image.png                       # byte-copied as-is
```
